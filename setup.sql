-- Create the database and schema
CREATE DATABASE IF NOT EXISTS CALLAWAY_PLATFORM;
USE DATABASE CALLAWAY_PLATFORM;
USE SCHEMA PUBLIC;

-- Create PRODUCTS table
CREATE OR REPLACE TABLE PRODUCTS (
    PRODUCT_ID INTEGER AUTOINCREMENT,
    SKU VARCHAR(50) UNIQUE,
    PRODUCT_NAME VARCHAR(200),
    CATEGORY VARCHAR(50),
    SUBCATEGORY VARCHAR(50),
    BRAND VARCHAR(50),
    PRICE DECIMAL(10,2),
    COST DECIMAL(10,2),
    LAUNCH_DATE DATE,
    IS_ACTIVE BOOLEAN DEFAULT TRUE,
    PRIMARY KEY (PRODUCT_ID)
);

-- Insert Callaway products
INSERT INTO PRODUCTS (SKU, PRODUCT_NAME, CATEGORY, SUBCATEGORY, BRAND, PRICE, COST, LAUNCH_DATE) VALUES
-- Drivers
('DR-PARDM-2024', 'Paradym Ai Smoke MAX Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 599.99, 300.00, '2024-01-15'),
('DR-PARDM-LS24', 'Paradym Ai Smoke MAX LS Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 599.99, 300.00, '2024-01-15'),
('DR-ROGST-MAX', 'Rogue ST MAX Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 499.99, 250.00, '2023-02-01'),
('DR-BBERTHA-23', 'Big Bertha B21 Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 399.99, 200.00, '2023-03-15'),

-- Fairway Woods
('FW-PARDM-3W', 'Paradym Ai Smoke MAX 3 Wood', 'CLUBS', 'FAIRWAY_WOODS', 'CALLAWAY', 349.99, 175.00, '2024-01-15'),
('FW-PARDM-5W', 'Paradym Ai Smoke MAX 5 Wood', 'CLUBS', 'FAIRWAY_WOODS', 'CALLAWAY', 329.99, 165.00, '2024-01-15'),

-- Irons
('IR-APEX24-SET', 'Apex 24 Irons (4-PW)', 'CLUBS', 'IRONS', 'CALLAWAY', 1399.99, 700.00, '2024-02-01'),
('IR-APEXTCB-SET', 'Apex TCB Irons (4-PW)', 'CLUBS', 'IRONS', 'CALLAWAY', 1599.99, 800.00, '2023-09-01'),
('IR-ROGST-SET', 'Rogue ST MAX Irons (5-PW,AW)', 'CLUBS', 'IRONS', 'CALLAWAY', 999.99, 500.00, '2023-02-01'),
('IR-BBERTHA-SET', 'Big Bertha B21 Irons (5-PW,AW)', 'CLUBS', 'IRONS', 'CALLAWAY', 899.99, 450.00, '2023-03-15'),

-- Wedges
('WG-JAWS-RAW-52', 'JAWS RAW Chrome Wedge 52°', 'CLUBS', 'WEDGES', 'CALLAWAY', 179.99, 90.00, '2023-03-01'),
('WG-JAWS-RAW-56', 'JAWS RAW Chrome Wedge 56°', 'CLUBS', 'WEDGES', 'CALLAWAY', 179.99, 90.00, '2023-03-01'),
('WG-JAWS-RAW-60', 'JAWS RAW Chrome Wedge 60°', 'CLUBS', 'WEDGES', 'CALLAWAY', 179.99, 90.00, '2023-03-01'),
('WG-MD5-JAWS-54', 'MD5 JAWS Wedge 54°', 'CLUBS', 'WEDGES', 'CALLAWAY', 169.99, 85.00, '2022-09-01'),

-- Putters (Odyssey)
('PT-WHOT-2B', 'Odyssey White Hot OG #7 Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 249.99, 125.00, '2023-01-15'),
('PT-WHOT-MALLET', 'Odyssey White Hot OG 2-Ball Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 299.99, 150.00, '2023-01-15'),
('PT-TOULON-ATL', 'Toulon Design Atlanta Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 449.99, 225.00, '2023-06-01'),
('PT-TRIHT-7', 'Odyssey Tri-Hot 5K #7 Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 299.99, 150.00, '2024-02-01'),

-- Golf Balls
('GB-CHRSOFT-24', 'Chrome Soft Golf Balls (12 pack)', 'BALLS', 'PREMIUM', 'CALLAWAY', 54.99, 30.00, '2024-01-01'),
('GB-CHRSOFT-X24', 'Chrome Soft X Golf Balls (12 pack)', 'BALLS', 'PREMIUM', 'CALLAWAY', 54.99, 30.00, '2024-01-01'),
('GB-CHRTOUR-24', 'Chrome Tour Golf Balls (12 pack)', 'BALLS', 'TOUR', 'CALLAWAY', 54.99, 30.00, '2024-02-01'),
('GB-CHRTOURX-24', 'Chrome Tour X Golf Balls (12 pack)', 'BALLS', 'TOUR', 'CALLAWAY', 54.99, 30.00, '2024-02-01'),
('GB-SUPSOFT-24', 'Supersoft Golf Balls (12 pack)', 'BALLS', 'DISTANCE', 'CALLAWAY', 24.99, 12.00, '2024-01-01'),
('GB-WARBIRD-24', 'Warbird Golf Balls (12 pack)', 'BALLS', 'DISTANCE', 'CALLAWAY', 19.99, 10.00, '2024-01-01'),

-- Golf Bags
('BG-ORG14-BLK', 'Org 14 Cart Bag - Black', 'BAGS', 'CART_BAGS', 'CALLAWAY', 279.99, 140.00, '2023-11-01'),
('BG-ORG14-NVY', 'Org 14 Cart Bag - Navy', 'BAGS', 'CART_BAGS', 'CALLAWAY', 279.99, 140.00, '2023-11-01'),
('BG-FWYC-DBL', 'Fairway C Double Strap Stand Bag', 'BAGS', 'STAND_BAGS', 'CALLAWAY', 239.99, 120.00, '2023-10-01'),
('BG-HYPER-ZERO', 'Hyperlite Zero Stand Bag', 'BAGS', 'STAND_BAGS', 'CALLAWAY', 259.99, 130.00, '2024-01-15'),

-- Apparel (TravisMathew)
('AP-TM-POLO-BLK', 'TravisMathew Cloud Polo - Black', 'APPAREL', 'POLOS', 'TRAVISMATHEW', 89.99, 45.00, '2024-03-01'),
('AP-TM-POLO-WHT', 'TravisMathew Cloud Polo - White', 'APPAREL', 'POLOS', 'TRAVISMATHEW', 89.99, 45.00, '2024-03-01'),
('AP-TM-SHORT-NVY', 'TravisMathew Beck Shorts - Navy', 'APPAREL', 'SHORTS', 'TRAVISMATHEW', 79.99, 40.00, '2024-03-01'),
('AP-CW-HAT-ADJ', 'Callaway Tour Authentic Adjustable Hat', 'APPAREL', 'HEADWEAR', 'CALLAWAY', 29.99, 15.00, '2024-02-01');

-- Create SALES_DATA table
CREATE OR REPLACE TABLE SALES_DATA (
    SALE_ID INTEGER AUTOINCREMENT,
    SALE_DATE DATE,
    PRODUCT_ID INTEGER,
    STATE VARCHAR(50),
    REGION VARCHAR(50),
    QUANTITY INTEGER,
    UNIT_PRICE DECIMAL(10,2),
    TOTAL_AMOUNT DECIMAL(10,2),
    DISCOUNT_PERCENT DECIMAL(5,2) DEFAULT 0,
    NET_AMOUNT DECIMAL(10,2),
    CHANNEL VARCHAR(50),
    CUSTOMER_TYPE VARCHAR(50),
    PRIMARY KEY (SALE_ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID)
);

-- Create the database and schema
CREATE DATABASE IF NOT EXISTS CALLAWAY_PLATFORM;
USE DATABASE CALLAWAY_PLATFORM;
USE SCHEMA PUBLIC;

-- Create PRODUCTS table
CREATE OR REPLACE TABLE PRODUCTS (
    PRODUCT_ID INTEGER AUTOINCREMENT,
    SKU VARCHAR(50) UNIQUE,
    PRODUCT_NAME VARCHAR(200),
    CATEGORY VARCHAR(50),
    SUBCATEGORY VARCHAR(50),
    BRAND VARCHAR(50),
    PRICE DECIMAL(10,2),
    COST DECIMAL(10,2),
    LAUNCH_DATE DATE,
    IS_ACTIVE BOOLEAN DEFAULT TRUE,
    PRIMARY KEY (PRODUCT_ID)
);

-- Insert Callaway products
INSERT INTO PRODUCTS (SKU, PRODUCT_NAME, CATEGORY, SUBCATEGORY, BRAND, PRICE, COST, LAUNCH_DATE) VALUES
-- Drivers
('DR-PARDM-2024', 'Paradym Ai Smoke MAX Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 599.99, 300.00, '2024-01-15'),
('DR-PARDM-LS24', 'Paradym Ai Smoke MAX LS Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 599.99, 300.00, '2024-01-15'),
('DR-ROGST-MAX', 'Rogue ST MAX Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 499.99, 250.00, '2023-02-01'),
('DR-BBERTHA-23', 'Big Bertha B21 Driver', 'CLUBS', 'DRIVERS', 'CALLAWAY', 399.99, 200.00, '2023-03-15'),

-- Fairway Woods
('FW-PARDM-3W', 'Paradym Ai Smoke MAX 3 Wood', 'CLUBS', 'FAIRWAY_WOODS', 'CALLAWAY', 349.99, 175.00, '2024-01-15'),
('FW-PARDM-5W', 'Paradym Ai Smoke MAX 5 Wood', 'CLUBS', 'FAIRWAY_WOODS', 'CALLAWAY', 329.99, 165.00, '2024-01-15'),

-- Irons
('IR-APEX24-SET', 'Apex 24 Irons (4-PW)', 'CLUBS', 'IRONS', 'CALLAWAY', 1399.99, 700.00, '2024-02-01'),
('IR-APEXTCB-SET', 'Apex TCB Irons (4-PW)', 'CLUBS', 'IRONS', 'CALLAWAY', 1599.99, 800.00, '2023-09-01'),
('IR-ROGST-SET', 'Rogue ST MAX Irons (5-PW,AW)', 'CLUBS', 'IRONS', 'CALLAWAY', 999.99, 500.00, '2023-02-01'),
('IR-BBERTHA-SET', 'Big Bertha B21 Irons (5-PW,AW)', 'CLUBS', 'IRONS', 'CALLAWAY', 899.99, 450.00, '2023-03-15'),

-- Wedges
('WG-JAWS-RAW-52', 'JAWS RAW Chrome Wedge 52°', 'CLUBS', 'WEDGES', 'CALLAWAY', 179.99, 90.00, '2023-03-01'),
('WG-JAWS-RAW-56', 'JAWS RAW Chrome Wedge 56°', 'CLUBS', 'WEDGES', 'CALLAWAY', 179.99, 90.00, '2023-03-01'),
('WG-JAWS-RAW-60', 'JAWS RAW Chrome Wedge 60°', 'CLUBS', 'WEDGES', 'CALLAWAY', 179.99, 90.00, '2023-03-01'),
('WG-MD5-JAWS-54', 'MD5 JAWS Wedge 54°', 'CLUBS', 'WEDGES', 'CALLAWAY', 169.99, 85.00, '2022-09-01'),

-- Putters (Odyssey)
('PT-WHOT-2B', 'Odyssey White Hot OG #7 Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 249.99, 125.00, '2023-01-15'),
('PT-WHOT-MALLET', 'Odyssey White Hot OG 2-Ball Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 299.99, 150.00, '2023-01-15'),
('PT-TOULON-ATL', 'Toulon Design Atlanta Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 449.99, 225.00, '2023-06-01'),
('PT-TRIHT-7', 'Odyssey Tri-Hot 5K #7 Putter', 'CLUBS', 'PUTTERS', 'ODYSSEY', 299.99, 150.00, '2024-02-01'),

-- Golf Balls
('GB-CHRSOFT-24', 'Chrome Soft Golf Balls (12 pack)', 'BALLS', 'PREMIUM', 'CALLAWAY', 54.99, 30.00, '2024-01-01'),
('GB-CHRSOFT-X24', 'Chrome Soft X Golf Balls (12 pack)', 'BALLS', 'PREMIUM', 'CALLAWAY', 54.99, 30.00, '2024-01-01'),
('GB-CHRTOUR-24', 'Chrome Tour Golf Balls (12 pack)', 'BALLS', 'TOUR', 'CALLAWAY', 54.99, 30.00, '2024-02-01'),
('GB-CHRTOURX-24', 'Chrome Tour X Golf Balls (12 pack)', 'BALLS', 'TOUR', 'CALLAWAY', 54.99, 30.00, '2024-02-01'),
('GB-SUPSOFT-24', 'Supersoft Golf Balls (12 pack)', 'BALLS', 'DISTANCE', 'CALLAWAY', 24.99, 12.00, '2024-01-01'),
('GB-WARBIRD-24', 'Warbird Golf Balls (12 pack)', 'BALLS', 'DISTANCE', 'CALLAWAY', 19.99, 10.00, '2024-01-01'),

-- Golf Bags
('BG-ORG14-BLK', 'Org 14 Cart Bag - Black', 'BAGS', 'CART_BAGS', 'CALLAWAY', 279.99, 140.00, '2023-11-01'),
('BG-ORG14-NVY', 'Org 14 Cart Bag - Navy', 'BAGS', 'CART_BAGS', 'CALLAWAY', 279.99, 140.00, '2023-11-01'),
('BG-FWYC-DBL', 'Fairway C Double Strap Stand Bag', 'BAGS', 'STAND_BAGS', 'CALLAWAY', 239.99, 120.00, '2023-10-01'),
('BG-HYPER-ZERO', 'Hyperlite Zero Stand Bag', 'BAGS', 'STAND_BAGS', 'CALLAWAY', 259.99, 130.00, '2024-01-15'),

-- Apparel (TravisMathew)
('AP-TM-POLO-BLK', 'TravisMathew Cloud Polo - Black', 'APPAREL', 'POLOS', 'TRAVISMATHEW', 89.99, 45.00, '2024-03-01'),
('AP-TM-POLO-WHT', 'TravisMathew Cloud Polo - White', 'APPAREL', 'POLOS', 'TRAVISMATHEW', 89.99, 45.00, '2024-03-01'),
('AP-TM-SHORT-NVY', 'TravisMathew Beck Shorts - Navy', 'APPAREL', 'SHORTS', 'TRAVISMATHEW', 79.99, 40.00, '2024-03-01'),
('AP-CW-HAT-ADJ', 'Callaway Tour Authentic Adjustable Hat', 'APPAREL', 'HEADWEAR', 'CALLAWAY', 29.99, 15.00, '2024-02-01');

-- Create SALES_DATA table
CREATE OR REPLACE TABLE SALES_DATA (
    SALE_ID INTEGER AUTOINCREMENT,
    SALE_DATE DATE,
    PRODUCT_ID INTEGER,
    STATE VARCHAR(50),
    REGION VARCHAR(50),
    QUANTITY INTEGER,
    UNIT_PRICE DECIMAL(10,2),
    TOTAL_AMOUNT DECIMAL(10,2),
    DISCOUNT_PERCENT DECIMAL(5,2) DEFAULT 0,
    NET_AMOUNT DECIMAL(10,2),
    CHANNEL VARCHAR(50),
    CUSTOMER_TYPE VARCHAR(50),
    PRIMARY KEY (SALE_ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID)
);

-- Alternative: Direct SQL inserts without stored procedure
-- This generates sample sales data directly

-- First, let's insert some sample sales data for high-performing states
INSERT INTO SALES_DATA (SALE_DATE, PRODUCT_ID, STATE, REGION, QUANTITY, UNIT_PRICE, DISCOUNT_PERCENT, CHANNEL, CUSTOMER_TYPE)
SELECT 
    DATEADD(DAY, UNIFORM(0, 364, RANDOM()), '2024-01-01'::DATE) as SALE_DATE,
    p.PRODUCT_ID,
    s.STATE,
    s.REGION,
    UNIFORM(1, 5, RANDOM()) as QUANTITY,
    p.PRICE as UNIT_PRICE,
    CASE WHEN UNIFORM(1, 10, RANDOM()) > 7 THEN UNIFORM(5, 15, RANDOM()) ELSE 0 END as DISCOUNT_PERCENT,
    CASE UNIFORM(1, 3, RANDOM()) 
        WHEN 1 THEN 'RETAIL'
        WHEN 2 THEN 'ONLINE'
        ELSE 'PRO_SHOP'
    END as CHANNEL,
    CASE UNIFORM(1, 3, RANDOM())
        WHEN 1 THEN 'CONSUMER'
        WHEN 2 THEN 'CORPORATE'
        ELSE 'PRO'
    END as CUSTOMER_TYPE
FROM PRODUCTS p
CROSS JOIN (
    SELECT 'California' as STATE, 'WEST' as REGION
    UNION ALL SELECT 'Florida', 'SOUTH'
    UNION ALL SELECT 'Texas', 'SOUTH'
    UNION ALL SELECT 'Arizona', 'WEST'
    UNION ALL SELECT 'Georgia', 'SOUTH'
) s
CROSS JOIN (SELECT SEQ4() as n FROM TABLE(GENERATOR(ROWCOUNT => 500))) g
WHERE g.n < 100;  -- 100 transactions per state

-- Insert for medium-performing states
INSERT INTO SALES_DATA (SALE_DATE, PRODUCT_ID, STATE, REGION, QUANTITY, UNIT_PRICE, DISCOUNT_PERCENT, CHANNEL, CUSTOMER_TYPE)
SELECT 
    DATEADD(DAY, UNIFORM(0, 364, RANDOM()), '2024-01-01'::DATE) as SALE_DATE,
    p.PRODUCT_ID,
    s.STATE,
    s.REGION,
    UNIFORM(1, 3, RANDOM()) as QUANTITY,
    p.PRICE as UNIT_PRICE,
    CASE WHEN UNIFORM(1, 10, RANDOM()) > 8 THEN UNIFORM(5, 10, RANDOM()) ELSE 0 END as DISCOUNT_PERCENT,
    CASE UNIFORM(1, 3, RANDOM()) 
        WHEN 1 THEN 'RETAIL'
        WHEN 2 THEN 'ONLINE'
        ELSE 'PRO_SHOP'
    END as CHANNEL,
    CASE UNIFORM(1, 3, RANDOM())
        WHEN 1 THEN 'CONSUMER'
        WHEN 2 THEN 'CORPORATE'
        ELSE 'PRO'
    END as CUSTOMER_TYPE
FROM PRODUCTS p
CROSS JOIN (
    SELECT 'New York' as STATE, 'EAST' as REGION
    UNION ALL SELECT 'Illinois', 'MIDWEST'
    UNION ALL SELECT 'Ohio', 'MIDWEST'
    UNION ALL SELECT 'Michigan', 'MIDWEST'
    UNION ALL SELECT 'Pennsylvania', 'EAST'
) s
CROSS JOIN (SELECT SEQ4() as n FROM TABLE(GENERATOR(ROWCOUNT => 300))) g
WHERE g.n < 50;  -- 50 transactions per state

-- Insert for low-performing states
INSERT INTO SALES_DATA (SALE_DATE, PRODUCT_ID, STATE, REGION, QUANTITY, UNIT_PRICE, DISCOUNT_PERCENT, CHANNEL, CUSTOMER_TYPE)
SELECT 
    DATEADD(DAY, UNIFORM(0, 364, RANDOM()), '2024-01-01'::DATE) as SALE_DATE,
    p.PRODUCT_ID,
    s.STATE,
    s.REGION,
    UNIFORM(1, 2, RANDOM()) as QUANTITY,
    p.PRICE as UNIT_PRICE,
    CASE WHEN UNIFORM(1, 10, RANDOM()) > 9 THEN UNIFORM(5, 10, RANDOM()) ELSE 0 END as DISCOUNT_PERCENT,
    CASE UNIFORM(1, 3, RANDOM()) 
        WHEN 1 THEN 'RETAIL'
        WHEN 2 THEN 'ONLINE'
        ELSE 'PRO_SHOP'
    END as CHANNEL,
    CASE UNIFORM(1, 3, RANDOM())
        WHEN 1 THEN 'CONSUMER'
        WHEN 2 THEN 'CORPORATE'
        ELSE 'PRO'
    END as CUSTOMER_TYPE
FROM PRODUCTS p
CROSS JOIN (
    SELECT 'Montana' as STATE, 'WEST' as REGION
    UNION ALL SELECT 'Wyoming', 'WEST'
    UNION ALL SELECT 'Vermont', 'EAST'
    UNION ALL SELECT 'Maine', 'EAST'
    UNION ALL SELECT 'Alaska', 'WEST'
) s
CROSS JOIN (SELECT SEQ4() as n FROM TABLE(GENERATOR(ROWCOUNT => 150))) g
WHERE g.n < 20;  -- 20 transactions per state

-- Update TOTAL_AMOUNT and NET_AMOUNT
UPDATE SALES_DATA 
SET TOTAL_AMOUNT = QUANTITY * UNIT_PRICE,
    NET_AMOUNT = QUANTITY * UNIT_PRICE * (1 - DISCOUNT_PERCENT/100);

-- Verify the data was created
SELECT COUNT(*) as TOTAL_SALES FROM SALES_DATA;
SELECT STATE, COUNT(*) as SALES_COUNT, SUM(NET_AMOUNT) as TOTAL_REVENUE 
FROM SALES_DATA 
GROUP BY STATE 
ORDER BY TOTAL_REVENUE DESC;


select * from products;

select * from sales_data;


WITH __sales_data AS (
  SELECT
    sale_date,
    net_amount
  FROM callaway_platform.public.sales_data
)
SELECT
  DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 MONTH') AS month,
  SUM(net_amount) AS total_revenue
FROM __sales_data
WHERE
  DATE_TRUNC('MONTH', sale_date) = DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 MONTH')
GROUP BY
  DATE_TRUNC('MONTH', CURRENT_DATE - INTERVAL '1 MONTH')
ORDER BY
  month DESC NULLS LAST
 -- Generated by Cortex Analyst
;


UPDATE CALLAWAY_PLATFORM.PUBLIC.SALES_DATA
SET 
    TOTAL_AMOUNT = QUANTITY * UNIT_PRICE,
    NET_AMOUNT = QUANTITY * UNIT_PRICE * (1 - DISCOUNT_PERCENT/100);